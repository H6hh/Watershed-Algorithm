# Watershed-Algorithm
分水岭算法  
图像分水岭算法（Watershed Algorithm）是将图像的边缘轮廓转换为“山脉”，将均匀区域转换为“山谷”，从而提升分割效果的算法。分水岭算法是基于拓扑理论的数学形态学的分割方法，灰度图像根据灰度值把像素之间的关系看成山峰和山谷的关系，高亮度（灰度值高）的地方是山峰，低亮度（灰度值低）的地方是山谷。接着给每个孤立的山谷（局部最小值）不同颜色的水（Label），当水涨起来，根据周围的山峰（梯度），不同的山谷也就是不同颜色的像素点开始合并，为了避免这个现象，可以在水要合并的地方建立障碍，直到所有山峰都被淹没。所创建的障碍就是分割结果，这个就是分水岭的原理。   

分水岭算法的计算过程是一个迭代标注过程，主要包括排序和淹没两个步骤。由于图像会存在噪声或缺失等问题，该方法会造成分割过度。OpenCV提供了watershed()函数实现图像分水岭算法，并且能够指定需要合并的点，其函数原型如下所示：   

markers = watershed(image, markers)   
– image表示输入图像，需为8位三通道的彩色图像     
– markers表示用于存储函数调用之后的运算结果，输入/输出32位单通道图像的标记结构，输出结果需和输入图像的尺寸和类型一致。   
第一步，通过图像灰度化和阈值化处理提取图像灰度轮廓，   ![1686289086534](https://github.com/H6hh/Watershed-Algorithm/assets/98206033/f9e34e99-50b4-47bc-a6ca-2a1cc95983ed)   
第二步，通过形态学开运算过滤掉小的白色噪声。输出结果如图所示，包括原始图像、阈值化处理、开运算、背景区域、前景区域、未知区域等。   ![image](https://github.com/H6hh/Watershed-Algorithm/assets/98206033/0010c081-6047-410f-b303-b7b93672a2f9)  
第三步，当前处理结果中，接创建标记变量，在该变量中标记区域，已确认的区域（前景或背景）用不同的正整数标记出来，不确认的区域保持0，使用cv2.connectedComponents()函数来将图像背景标记成0，其他目标用从1开始的整数标记。注意，如果背景被标记成0，分水岭算法会认为它是未知区域，所以要用不同的整数来标记。  
最后，调用watershed()函数实现分水岭图像分割，标记图像会被修改，边界区域会被标记成0
